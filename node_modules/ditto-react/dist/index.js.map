{"version":3,"file":"index.js","sources":["../src/lib/context.ts","../src/lib/utils.tsx","../src/hooks/useDittoSingleText.ts","../src/components/DittoText.tsx","../src/hooks/useDitto.ts","../src/components/DittoFrameOrBlock.tsx","../src/hooks/useDittoComponent.ts","../src/components/DittoComponent.tsx","../src/components/Ditto.tsx","../src/components/DittoProvider.tsx"],"sourcesContent":["import { createContext } from \"react\";\nimport { Plurals } from \"../components/Ditto\";\n\nexport type Count = number | undefined;\n\nexport interface VariableData {\n  text?: string;\n  url?: string;\n  example?: string;\n  fallback?: string;\n}\n\ntype VariableType = string | number;\nexport interface VariablesInput {\n  [variableId: string]: VariableType;\n}\n\nexport interface TextData {\n  plurals: Plurals;\n  text: string;\n  variables: {\n    [variableName: string]: VariableData;\n  };\n}\n\nexport interface Block {\n  text: string;\n}\nexport interface Frame {\n  frameName: string;\n  blocks: Block[];\n  otherText?: Block[];\n}\n\nexport interface FormatDefaultProject {\n  [frameId: string]: Frame;\n}\n\ninterface FormatStructured {\n  [id: string]: {\n    text: string;\n    plurals: Plurals;\n    variables: {\n      [variableName: string]: VariableData;\n    };\n  };\n}\n\ninterface FormatDefaultComponentLibrary {\n  [componentApiId: string]: {\n    name: string;\n    text: string;\n  };\n}\n\ninterface FormatStructuredProject {\n  [apiId: string]: {\n    text: string;\n    tags?: string[];\n    notes?: string;\n  };\n}\n\ninterface FormatStructuredCL {\n  [apiId: string]: {\n    name: string;\n    text: string;\n  };\n}\n\ninterface FormatFlat {\n  [apiId: string]: string;\n}\n\nexport type ProjectFormat =\n  | FormatDefaultProject\n  | FormatFlat\n  | FormatStructuredProject;\n\nexport type ComponentLibraryFormat =\n  | FormatDefaultComponentLibrary\n  | FormatFlat\n  | FormatStructuredCL;\n\nexport type Project = ProjectFormat | ComponentLibraryFormat;\n\nexport interface Source {\n  projects: {\n    [projectId: string]: Project;\n  };\n  exported_at: string;\n}\n\nexport interface SourceVariants {\n  [variantApiId: string]: Source;\n}\n\ntype SourceType =\n  | FormatDefaultProject\n  // This type matches for:\n  // - `default` and `structured` formats for the component library\n  // - `structured` format for projects\n  | FormatStructured\n  // This type matches for both projects and the component library\n  | FormatFlat\n  | { [key: string]: any };\n\nexport type DittoSource = {\n  [projectId: string]: {\n    [variantApiId: string]: SourceType;\n  };\n};\n\nexport const SourceDetector = {\n  isFrame: function (source: SourceType): source is FormatDefaultProject {\n    if (!source) {\n      return false;\n    }\n\n    const value = source[Object.keys(source)[0]];\n    return value !== null && typeof value === \"object\" && \"frameName\" in value;\n  },\n  isFlat: function (source: SourceType): source is FormatFlat {\n    if (!source) {\n      return false;\n    }\n\n    const value = source[Object.keys(source)[0]];\n    return typeof value === \"string\";\n  },\n  isStructured: function (source: SourceType): source is FormatStructured {\n    if (!source) {\n      return false;\n    }\n\n    const value = source[Object.keys(source)[0]];\n    return value !== null && typeof value === \"object\" && !this.isFrame(source);\n  },\n};\n\ninterface DittoContext {\n  projectId?: string;\n  variant?: string;\n  source: DittoSource;\n}\n\nexport const DittoContext = createContext({} as DittoContext);\n","import { Fragment, useContext } from \"react\";\nimport {\n  DittoComponentLibraryProps,\n  DittoProjectProps,\n  DittoProps,\n  DittoFrameOrBlockProps,\n  DittoTextProps,\n} from \"../components/Ditto\";\nimport { DittoContext, Frame, Block, VariablesInput, Count, TextData } from \"./context\";\n\nexport const filterBlock = (blockObj: Block, variables: VariablesInput, count: Count, filters) => {\n\n  return Object.keys(blockObj)\n    .filter((textId) => {\n      if (!filters?.tags) return true;\n\n      return filters.tags.every(\n        (tag) => blockObj[textId].tags && blockObj[textId].tags.includes(tag)\n      );\n    })\n    .reduce((obj, id) => {\n      const interpolatedText = interpolateVariableText(blockObj[id], variables, count).text\n      return { ...obj, [id]: interpolatedText }\n    }, {} as Block);\n};\n\nexport const filterFrame = (_frameObj: Frame, variables: VariablesInput, count: Count, filters) => {\n  const frameObj = JSON.parse(JSON.stringify(_frameObj));\n\n  if (frameObj.blocks) {\n    for (var blockId in frameObj.blocks) {\n      frameObj.blocks[blockId] = filterBlock(frameObj.blocks[blockId], variables, count, filters);\n    }\n  }\n\n  return { ...frameObj, otherText: filterBlock(frameObj.otherText, variables, count, filters) };\n};\n\nexport const error = (message: string, returnValue: any = message) => {\n  console.error(message);\n  return returnValue;\n};\n\nexport const nullError = (message: string) => error(message, null);\nexport const fragmentError = (message: string) => error(message, <Fragment />);\n\nexport const isProject = (\n  props: DittoProps,\n  projectIdFromContext?: string\n): props is DittoProjectProps =>\n  (\"projectId\" in props || !!projectIdFromContext) &&\n  (\"textId\" in props || \"frameId\" in props || \"blockId\" in props);\n\nexport const isComponentLibrary = (\n  props: DittoProps\n): props is DittoComponentLibraryProps => \"componentId\" in props;\n\nexport const isText = (props: DittoProps): props is DittoTextProps =>\n  \"textId\" in props;\n\nexport const isFrameOrBlockComponent = (\n  props: DittoProps\n): props is DittoFrameOrBlockProps => \"frameId\" in props;\n\nexport const useProjectId = (props: { projectId?: string }) => {\n  const dittoContext = useContext(DittoContext);\n  const projectId = dittoContext.projectId || props.projectId;\n  if (!projectId) {\n    return fragmentError(\n      \"No Project ID was provided to the <DittoProvider /> or <Ditto /> components.\"\n    );\n  }\n\n  return projectId;\n};\n\n/**\n * \n * @param data\n * text data\n * @param count \n * the variable number used to determine which plural case to use\n * zero = 0\n * one = 1\n * two = 2\n * few = 3,4,5\n * many = 6,7,...,99\n * other = 100, 101, ...\n * if count is provided but not matching plural key, fallback to base plural value\n * in future we should also user's to define their own middleware for picking plurals\n * based off i8next: https://www.i18next.com/translation-function/plurals\n */\nconst getPluralText = (data: TextData, count: Count) => {\n  if (count === undefined|| Object.keys(data?.plurals || {})?.length === 0) {\n    return data.text\n  }\n  else if (count === 0 && data.plurals.zero) {\n    return data.plurals.zero\n  } else if (count === 1 && data.plurals.one) {\n    return data.plurals.one\n  } else if (count === 2 && data.plurals.two) {\n    return data.plurals.two\n  } else if (count >= 3 && count <= 5 && data.plurals.few) {\n    return data.plurals.few\n  } else if (count >= 6 && count <= 99 && data.plurals.many) {\n    return data.plurals.many\n  } else {\n    // default to 'other', fallback to base text\n    if (data.plurals.other) return data.plurals.other\n    return data.text\n  }\n}\n\nexport const interpolateVariableText = (data: TextData, variables: VariablesInput, count: Count) => {\n  const variablesWithFallbacks = Object.keys(data?.variables || {}).reduce((acc, curr) => {\n    if (variables[curr]) {\n      acc[curr] = variables[curr]\n    } else {\n      const { fallback, text } = data.variables[curr]\n      acc[curr] = fallback || text\n    }\n    return acc;\n  }, {})\n  const pluralText = getPluralText(data, count)\n  return {\n    ...data,\n    text: generateVariableText(pluralText, variablesWithFallbacks)\n  }\n}\n\nconst HANDLEBAR_REGEX = /\\{\\{([a-z0-9_]+)\\}\\}/gi;\n\n/**\n * Execute a callback for each valid variable found in\n * `text`. The callback is passed an object that includes:\n * - `name`: the name of the variable\n * - `start`: the index of opening curly brace of the variable in `text`\n * - `end`: the index of the closing curly brace of the variable in `text`\n */\nconst forEachVariable = (text, callback) => {\n  let matches: RegExpExecArray | null = null;\n\n  while ((matches = HANDLEBAR_REGEX.exec(text)) !== null) {\n    const [match] = matches;\n    if (!match) {\n      break;\n    }\n\n    const variableName = match.replace(/(\\{\\{|\\}\\})/g, \"\");\n\n    callback({\n      name: variableName,\n      start: matches.index,\n      end: matches.index + match.length - 1,\n    });\n  }\n};\n\nconst getVariable = (variableName, variables) => {\n  const variable = variables[variableName]\n  if (!variable) {\n    return null;\n  }\n\n  return variable;\n};\n\nconst getVariablePlaceholder = (variable) => {\n  if (!(variable && variable.data)) {\n    return null;\n  }\n\n  if (variable.data.fallback) {\n    return String(variable.data.fallback);\n  }\n\n  if (variable.data.text) {\n    return String(variable.data.text);\n  }\n\n  return null;\n};\n\nconst generateVariableText = (text, variables) => {\n  let lastIndex = 0;\n  let updatedText = \"\";\n  forEachVariable(text, ({ name, start, end }) => {\n    const variableValue = getVariable(name, variables) || getVariablePlaceholder(name);\n    if (variableValue) {\n      updatedText += text.substring(lastIndex, start) + variableValue;\n    } else {\n      updatedText += text.substr(lastIndex, end + 1);\n    }\n    lastIndex = end + 1;\n  });\n\n  const remainder = text.substr(lastIndex);\n  if (remainder) {\n    updatedText += remainder;\n  }\n  return updatedText;\n};","import { useContext } from \"react\";\nimport {\n  DittoContext,\n  SourceDetector,\n  VariablesInput,\n  Count,\n} from \"../lib/context\";\nimport { nullError, interpolateVariableText } from \"../lib/utils\";\n\ninterface useDittoSingleTextProps {\n  projectId?: string;\n  textId: string;\n  variables: VariablesInput;\n  count?: Count;\n}\n\nexport const useDittoSingleText = (props: useDittoSingleTextProps) => {\n  const { projectId, textId, variables, count } = props;\n  const { source, variant } = useContext(DittoContext);\n\n  if (!projectId) return nullError(\"No Project ID provided.\");\n\n  if (variant) {\n    const data = source?.[projectId]?.[variant];\n    if (data) {\n      if (SourceDetector.isStructured(data)) {\n        return interpolateVariableText(data[textId], variables, count).text;\n      }\n\n      if (SourceDetector.isFlat(data)) {\n        return data[textId];\n      }\n\n      if (SourceDetector.isFrame(data)) {\n        for (const frameId in data) {\n          const frame = data[frameId];\n\n          for (const blockId in frame.blocks) {\n            const block = frame.blocks[blockId];\n\n            if (textId in block)\n              return interpolateVariableText(block[textId], variables, count)\n                .text;\n          }\n\n          if (frame.otherText && textId in frame.otherText)\n            return interpolateVariableText(\n              frame.otherText[textId],\n              variables,\n              count\n            ).text;\n        }\n      }\n    }\n  }\n\n  const data = source?.[projectId]?.base;\n  if (!data) {\n    return nullError(`Project not found with id \"${projectId}\"`);\n  }\n\n  if (SourceDetector.isStructured(data)) {\n    return interpolateVariableText(data[textId], variables, count).text;\n  }\n\n  if (SourceDetector.isFlat(data)) {\n    return data[textId];\n  }\n\n  if (SourceDetector.isFrame(data)) {\n    for (const frameId in data) {\n      const frame = data[frameId];\n\n      for (const blockId in frame.blocks) {\n        const block = frame.blocks[blockId];\n\n        if (textId in block)\n          return interpolateVariableText(block[textId], variables, count).text;\n      }\n\n      if (frame.otherText && textId in frame.otherText)\n        return interpolateVariableText(\n          frame.otherText[textId],\n          variables,\n          count\n        ).text;\n    }\n  }\n\n  return `Text not found for id \"${textId}\"`;\n};\n","import React from \"react\";\nimport { useDittoSingleText } from \"../hooks/useDittoSingleText\";\nimport { useProjectId } from \"../lib/utils\";\nimport { DittoTextProps } from \"./Ditto\";\n\nexport const DittoText = (props: DittoTextProps) => {\n  const { textId, children, variables, count } = props;\n  const projectId = useProjectId(props);\n  const text = useDittoSingleText({ projectId, textId, variables: variables || {}, count });\n\n  return (\n    <React.Fragment>\n      {typeof children === \"function\" ? children(text) : text}\n    </React.Fragment>\n  );\n};\n","import { useContext } from \"react\";\nimport { DittoContext, SourceDetector, VariablesInput } from \"../lib/context\";\nimport { filterFrame, filterBlock, nullError } from \"../lib/utils\";\n\ninterface useDittoProps {\n  projectId?: string;\n  frameId: string;\n  blockId?: string;\n  variables?: VariablesInput;\n  count?: number;\n  filters?: {\n    tags: string[];\n  };\n}\n\nexport const useDitto = (props: useDittoProps) => {\n  const { projectId, frameId, blockId, filters, variables, count } = props;\n  const { source, variant } = useContext(DittoContext);\n\n  if (!projectId) return nullError(\"No Project ID provided.\");\n\n  if (variant) {\n    const data = source?.[projectId]?.[variant];\n    if (SourceDetector.isFrame(data) && frameId) {\n      const frame = data[frameId];\n      if (frame) {\n        if (!blockId) {\n          return filterFrame(frame, variables || {}, count, filters);\n        }\n        if (blockId in frame.blocks) {\n          const block = frame.blocks[blockId];\n          if (block) {\n            return filterBlock(block, variables || {}, count, filters);\n          }\n        }\n      }\n    }\n  }\n\n  const data = source[projectId]?.base;\n  if (!data) {\n    return nullError(`Project not found with id \"${projectId}\"`);\n  }\n\n  if (!SourceDetector.isFrame(data)) {\n    return nullError(\n      `Default format must be used if passing \"frameId\" or \"blockId\"`\n    );\n  }\n\n  if (!frameId) {\n    return nullError(\"No Frame ID provided.\");\n  }\n\n  const frame = data[frameId];\n  if (!frame)\n    return nullError(\n      `Frame \"${frameId}\" not found this project \"${projectId}\"`\n    );\n\n  if (!blockId) return filterFrame(frame, variables || {}, count, filters);\n\n  const block = frame.blocks[blockId];\n  if (!block)\n    return nullError(\n      `Block \"${blockId}\" not found in frame \"${frameId}\" in project \"${projectId}\"`\n    );\n\n  return filterBlock(block, variables || {}, count, filters);\n};\n","import React from \"react\";\nimport { useDitto } from \"../hooks/useDitto\";\nimport { fragmentError, useProjectId } from \"../lib/utils\";\nimport {\n  DittoBlockProps,\n  DittoFilters,\n  DittoFrameOrBlockProps,\n  DittoFrameProps,\n} from \"./Ditto\";\n\ntype Props = DittoFrameOrBlockProps;\n\nexport const DittoFrameOrBlock = (props: Props) => {\n  const { children, ...otherProps } = props;\n  const data = useDitto(otherProps);\n\n  if (typeof children !== \"function\") {\n    return fragmentError(\n      `Please provide either a textId or function child to your Ditto component.`\n    );\n  }\n\n  if (!data || typeof data !== \"object\") {\n    return <>{data}</>;\n  }\n\n  return <>{children(data)}</>;\n};\n\nexport const DittoFrame = (props: DittoFrameProps & DittoFilters) => {\n  const projectId = useProjectId(props);\n  return <DittoFrameOrBlock {...props} projectId={projectId} />;\n};\n\nexport const DittoBlock = (props: DittoBlockProps & DittoFilters) => {\n  const projectId = useProjectId(props);\n  return <DittoFrameOrBlock {...props} projectId={projectId} />;\n};\n","import { useContext } from \"react\";\nimport { DittoContext, SourceDetector, VariablesInput } from \"../lib/context\";\nimport { nullError, interpolateVariableText } from \"../lib/utils\";\n\ntype DittoComponentString = string;\ntype DittoComponentObject = {\n  text: string;\n};\ntype DittoComponent = DittoComponentString | DittoComponentObject;\n\ninterface Args {\n  componentId: string;\n  alwaysReturnString: boolean;\n  variables: VariablesInput;\n  count?: number;\n}\n\nexport const useDittoComponent = (props: Args): DittoComponent => {\n  const { componentId, alwaysReturnString, variables, count } = props;\n  const { source, variant } = useContext(DittoContext);\n  if (!(\"ditto_component_library\" in source)) {\n    throw new Error(\n      \"An export file for the Component Library couldn't be found.\"\n    );\n  }\n\n  if (variant) {\n    const data = source?.ditto_component_library?.[variant];\n    if (data && data[componentId]) {\n      if (SourceDetector.isStructured(data)) {\n        const value = interpolateVariableText(\n          data[componentId],\n          variables,\n          count\n        );\n        return alwaysReturnString ? value.text : value;\n      } else if (SourceDetector.isFlat(data)) {\n        return data[componentId];\n      }\n    }\n  }\n\n  const data = source?.ditto_component_library?.base;\n  if (!data) {\n    return nullError(\"Base text not found in component library\");\n  }\n\n  if (data && !data[componentId]) {\n    return nullError(`Text not found for component \"${componentId}\"`);\n  }\n\n  if (SourceDetector.isStructured(data)) {\n    const value = interpolateVariableText(data[componentId], variables, count);\n    return alwaysReturnString ? value.text : value;\n  } else if (SourceDetector.isFlat(data)) {\n    return data[componentId];\n  } else {\n    return nullError(`Invalid format for component ${componentId}`);\n  }\n};\n","import React, { useMemo } from \"react\";\nimport { useDittoComponent } from \"../hooks/useDittoComponent\";\nimport { DittoComponentLibraryProps } from \"./Ditto\";\n\nexport const DittoComponent = (props: DittoComponentLibraryProps) => {\n  const { children, componentId, variables, count } = props;\n\n  const value = useDittoComponent({\n    componentId,\n    alwaysReturnString: typeof children !== \"function\",\n    variables: variables || {},\n    count\n  });\n\n  const text = useMemo(\n    () => (value !== null && typeof value === \"object\" ? value.text : value),\n    [value]\n  );\n\n  return (\n    <React.Fragment>\n      {typeof children === \"function\" ? children(text) : text}\n    </React.Fragment>\n  );\n};\n","import { useContext } from \"react\";\nimport { DittoText } from \"./DittoText\";\nimport { DittoFrameOrBlock } from \"./DittoFrameOrBlock\";\nimport { DittoComponent } from \"./DittoComponent\";\nimport { Block, DittoContext, Frame, VariablesInput } from \"../lib/context\";\nimport {\n  isFrameOrBlockComponent,\n  isText,\n  fragmentError,\n  isComponentLibrary,\n  isProject,\n} from \"../lib/utils\";\n\ntype PluralId = \"zero\" | \"one\" | \"two\" | \"few\" | \"many\" | \"other\";\nexport type Plurals = {\n  [pluralId in PluralId]?: string;\n}\n\nexport interface DittoFrameProps {\n  projectId?: string;\n  frameId: string;\n  variables?: VariablesInput;\n  count?: number;\n  children: (frame: Frame) => React.ReactNode;\n}\n\nexport interface DittoBlockProps {\n  projectId?: string;\n  frameId: string;\n  blockId: string;\n  variables?: VariablesInput;\n  count?: number;\n  children: (block: Block) => React.ReactNode;\n}\n\nexport interface DittoTextProps {\n  projectId?: string;\n  textId: string;\n  variables?: VariablesInput;\n  count?: number;\n  children?: (text: string) => React.ReactNode;\n}\n\nexport interface DittoComponentLibraryProps {\n  componentId: string;\n  variables?: VariablesInput;\n  count?: number;\n  children?: (text: string) => React.ReactNode;\n}\n\nexport interface DittoFilters {\n  filters?: {\n    tags: string[];\n  };\n}\n\nexport type DittoFrameOrBlockProps = DittoFilters &\n  (DittoFrameProps | DittoBlockProps);\n\nexport type DittoProjectProps = DittoFilters &\n  (DittoFrameProps | DittoBlockProps | DittoTextProps);\n\nexport type DittoProps = DittoProjectProps | DittoComponentLibraryProps;\n\nexport function Ditto(props: DittoProps) {\n  const dittoContext = useContext(DittoContext);\n\n  if (isComponentLibrary(props)) {\n    return <DittoComponent {...props} />;\n  }\n\n  if (isProject(props, dittoContext.projectId)) {\n    const projectId = props.projectId || dittoContext.projectId;\n    if (!projectId) {\n      return fragmentError(\n        \"No Project ID was provided to the <DittoProvider /> or <Ditto /> components.\"\n      );\n    }\n\n    const propsWithProject = { ...props, projectId };\n\n    if (isText(propsWithProject)) {\n      return <DittoText {...propsWithProject} />;\n    }\n\n    if (isFrameOrBlockComponent(propsWithProject)) {\n      return <DittoFrameOrBlock {...propsWithProject} />;\n    }\n  }\n\n  return fragmentError(\n    'Invalid props provided to Ditto component; please provide \"componentId\", \"textId\" or \"frameId\"'\n  );\n}\n","import React from \"react\";\nimport { DittoContext, DittoSource } from \"../lib/context\";\n\ninterface DittoProviderProps {\n  projectId?: string;\n  variant?: string;\n  source: DittoSource;\n  children: React.ReactNode;\n}\n\nexport const DittoProvider = (props: DittoProviderProps) => {\n  const { children, source, variant, projectId } = props;\n\n  return (\n    <DittoContext.Provider\n      value={{\n        source,\n        variant,\n        ...(projectId ? { projectId } : {}),\n      }}\n    >\n      {children}\n    </DittoContext.Provider>\n  );\n};\n"],"names":["SourceDetector","isFrame","source","value","Object","keys","isFlat","isStructured","DittoContext","createContext","filterBlock","blockObj","variables","count","filters","filter","textId","tags","every","tag","includes","reduce","obj","id","interpolatedText","interpolateVariableText","text","filterFrame","_frameObj","frameObj","JSON","parse","stringify","blocks","blockId","otherText","error","message","returnValue","console","nullError","fragmentError","_jsx","Fragment","isProject","props","projectIdFromContext","isComponentLibrary","isText","isFrameOrBlockComponent","useProjectId","dittoContext","useContext","projectId","getPluralText","data","undefined","plurals","length","zero","one","two","few","many","other","variablesWithFallbacks","acc","curr","fallback","pluralText","generateVariableText","HANDLEBAR_REGEX","forEachVariable","callback","matches","exec","match","variableName","replace","name","start","index","end","getVariable","variable","getVariablePlaceholder","String","lastIndex","updatedText","variableValue","substring","substr","remainder","useDittoSingleText","variant","frameId","frame","block","base","DittoText","children","React","useDitto","DittoFrameOrBlock","otherProps","DittoFrame","DittoBlock","useDittoComponent","componentId","alwaysReturnString","Error","ditto_component_library","DittoComponent","useMemo","Ditto","propsWithProject","DittoProvider","Provider"],"mappings":"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"}